name: ğŸš€ Release AmiFlix

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      tag_name:
        description: 'Tag name for release'
        required: true
        default: 'v1.0.0'

jobs:
  release:
    name: ğŸš€ Create Release
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: â˜• Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle
    
    - name: ğŸ“± Setup Android SDK
      uses: android-actions/setup-android@v3
    
    - name: ğŸ”§ Grant execute permission for gradlew
      run: chmod +x gradlew
    
    - name: ğŸ”¨ Build release APK
      run: ./gradlew assembleDebug --stacktrace
    
    - name: ğŸ“ Get tag name
      id: tag_name
      run: |
        if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
          echo "TAG_NAME=${{ github.event.inputs.tag_name }}" >> $GITHUB_OUTPUT
        else
          echo "TAG_NAME=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
        fi
    
    - name: ğŸ“¦ Rename APK
      run: |
        mv app/build/outputs/apk/debug/app-debug.apk AmiFlix-${{ steps.tag_name.outputs.TAG_NAME }}-AndroidTV.apk
    
    - name: ğŸš€ Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ steps.tag_name.outputs.TAG_NAME }}
        name: ğŸŒ AmiFlix ${{ steps.tag_name.outputs.TAG_NAME }} - French Anime for Android TV
        body: |
          ## ğŸŒ AmiFlix - French Anime Android TV App
          
          ### ğŸ“± Installation Instructions
          1. **Download** the APK file below
          2. **Enable** "Unknown Sources" on your Android TV
          3. **Install** the APK using a file manager or ADB
          4. **Enjoy** French anime content!
          
          ### ğŸ¯ Features
          - ğŸ“º **Android TV Optimized** - D-pad navigation
          - ğŸ‡«ğŸ‡· **French Content** - Multiple anime sources  
          - ğŸ¨ **Beautiful Interface** - Dark theme, smooth animations
          - ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ **Family-Friendly** - Safe for all ages
          - ğŸ® **Easy Navigation** - TV remote control support
          
          ### ğŸ”§ Installation Methods
          
          **Method 1: USB Drive**
          ```
          1. Copy APK to USB drive
          2. Connect to Android TV
          3. Use file manager to install
          ```
          
          **Method 2: ADB**
          ```bash
          adb install AmiFlix-${{ steps.tag_name.outputs.TAG_NAME }}-AndroidTV.apk
          ```
          
          ### ğŸ†˜ Troubleshooting
          - Enable "Install from Unknown Sources" in Android TV settings
          - Use a file manager app if direct installation fails
          - Restart Android TV after installation
          
          **ğŸ‰ Enjoy watching French anime with AmiFlix!**
        files: |
          AmiFlix-${{ steps.tag_name.outputs.TAG_NAME }}-AndroidTV.apk
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 